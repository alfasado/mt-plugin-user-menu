name: User Menu
id:   UserMenu
key:  usermenu
version: 0.1
author_link: https://alfasado.net/
author_name: Alfasado Inc.
l10n_class: UserMenu::L10N
description: <__trans phrase="Show System Menu on Your Dashboard.">
config_settings:
    RemovableThisIsYouWidget:
        default: 1

# Override core menus

applications:
    cms:
        menus:
            website:manage:
                label: Manage
                order: 100
                mode: list_website
                view:
                    - system
                    - user
            website:create:
                label: New
                order: 200
                mode: view
                args:
                    _type: website
                view:
                    - system
                    - user
                permit_action: 'use_website:create_menu'
            user:manage:
                label: Manage
                order: 100
                mode: list_author
                permission: administer
                view:
                    - system
                    - user
            user:create:
                label: New
                order: 200
                mode: view
                args:
                    _type: author
                permission: administer
                condition: sub { return !MT->config->ExternalUserManagement; }
                view:
                    - system
                    - user
            design:template:
                label: Templates
                order: 100
                mode: list_template
                args:
                    _type: author
                permission: edit_templates
                system_permission: edit_templates
                view:
                    - system
                    - user
                    - website
                    - blog
            design:widgets:
                label: Widgets
                order: 200
                mode: list_template
                args:
                    _type: author
                permission: edit_templates
                system_permission: edit_templates
                view:
                    - system
                    - user
                    - website
                    - blog
            design:themes:
                label: Themes
                order: 500
                mode: list_theme
                args:
                    _type: author
                permit_action: 'use_design:themes_menu'
                view:
                    - system
                    - user
                    - website
                    - blog
            settings:system:
                label: General
                order: 100
                mode: cfg_system_general
                permission: administer
                view:
                    - system
                    - user
            settings:user:
                label: User
                order: 200
                mode: cfg_system_users
                permission: administer
                view:
                    - system
                    - user
            settings:role:
                label: Roles
                order: 300
                mode: list_role
                system_permission: administer
                view:
                    - system
                    - user
            settings:association:
                label: Permissions
                order: 400
                mode: list_association
                system_permission: administer
                view:
                    - system
                    - user
            tools:plugins:
                label: Plugins
                order: 200
                mode: cfg_plugins
                permission: administer_blog
                system_permission: manage_plugins
                view:
                    - system
                    - user
                    - website
                    - blog
            tools:start_backup:
                label: Backup
                order: 600
                mode: start_backup
                permission: administer_blog
                view:
                    - system
                    - user
                    - website
                    - blog
            tools:restore:
                label: Restore
                order: 650
                mode: start_restore
                permission: administer_blog
                view:
                    - system
                    - user
            tools:activity_log:
                label: Activity Log
                order: 800
                mode: list
                args:
                    _type: log
                permission: view_blog_log
                system_permission: view_log
                view:
                    - system
                    - user
                    - website
                    - blog
            tools:system_information:
                label: System Information
                order: 900
                mode: tools
                permit_action: 'use_tools:system_info_menu'
                view:
                    - system
                    - user
            custom_fields:manage:
                label: Manage
                order: 100
                mode: list_field
                permission: administer_blog,edit_config
                system_permission: administer
                condition: sub { return MT->component( 'Commercial' ); }
                view:
                    - system
                    - user
                    - website
                    - blog
            custom_fields:create:
                label: New
                order: 200
                mode: view
                args:
                    _type: field
                permission: administer_blog,edit_config
                system_permission: administer
                condition: sub { return MT->component( 'Commercial' ); }
                view:
                    - system
                    - user
                    - website
                    - blog
            tools:search:
                label: Search &amp; Replace
                order: 100
                mode: search_replace
                condition: >
                    sub {
                            return 1 if MT->instance()->user->is_superuser;
                            if ( MT->instance()->param( 'blog_id' ) ) {
                                my $perms = MT->instance()->user->permissions( MT->instance()->param( 'blog_id' ) );
                                return 0 unless $perms;
                                return 0 unless $perms->permissions;
                                return 0 unless $perms->can_do( 'use_tools:search' );
                            }
                            return 1;
                    }
                view:
                    - system
                    - user
                    - website
                    - blog
callbacks:
    MT::App::CMS::pre_run: $usermenu::UserMenu::Plugin::_pre_run
